<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wishlist - iGameDB</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="js/rawg-api.js"></script>
</head>
<body>

    <div class="header">
        <a href="index.html">        
            <img src="images/iGameDB.png" alt="iGameDB Logo">
        </a>

        <div class="search-bar">
            <form onsubmit="handleSearch(event)">
                <input type="text" placeholder="Search..." aria-label="Search games" id="searchInput">
            </form>
        </div>

        <nav class="nav-buttons">
            <a href="wishlist.html" class="wishlist">Wishlist</a>
            <a href="signin.html" class="sign-in">Sign In</a>
            <a href="about_us.html" class="about-link">About Us</a>
        </nav>
    </div>

    <div class="container">
        <section class="wishlist-section">
            <h2>MY WISHLIST</h2>
            <div class="game-grid" id="wishlistGrid">
                <div class="loading">Loading wishlist...</div>
            </div>
        </section>
    </div>

    <footer class="footer">
        <a href="index.html">        
            <img src="images/iGameDB.png" alt="iGameDB Logo">
        </a>

        <div class="footer-buttons">
            <button class="about" onclick="window.location.href='about_us.html'">About Us</button><br>
            <button class="follow">Follow Us</button>
        </div>
    </footer>

    <script>
        const API_KEY = '266fadd8dc914070b892d47f91163eeb';
        async function loadWishlist() {
            const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const container = document.getElementById('wishlistGrid');

            if (wishlist.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 40px;">Your wishlist is empty. <a href="index.html" style="color: #f5c518;">Start adding games!</a></p>';
                return;
            }

            container.innerHTML = '';

            // Fetch details for each game in wishlist
            for (const gameId of wishlist) {
                const game = await fetchGameDetails(gameId);
                if (game) {
                    displayWishlistGame(game, container);
                }
            }
        }

        function displayWishlistGame(game, container) {
            const gameCard = document.createElement('div');
            gameCard.className = 'game-card';
            gameCard.style.cursor = 'pointer';

            const backgroundImage = game.background_image ? `url(${game.background_image})` : 'linear-gradient(135deg, #f5c518 0%, #f50000 100%)';
            
            gameCard.innerHTML = `
                <div class="game-card-image" style="background-image: ${backgroundImage}; background-size: cover; background-position: center; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: flex-end; justify-content: space-between; padding: 10px; box-sizing: border-box;">
                    <button style="background-color: rgba(255,107,107,0.9); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;" onclick="removeFromWishlist(${game.id}, event)">Remove</button>
                    <div style="background-color: rgba(0,0,0,0.7); width: 100%; padding: 8px; border-radius: 5px; text-align: center; cursor: pointer;" onclick="window.location.href='specific_game.html?id=${game.id}'">
                        <span class="logo-text" style="display: block; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${game.name}</span>
                        <span style="display: block; text-align: center; font-size: 12px; color: #f5c518;">‚≠ê ${game.rating}/5</span>
                    </div>
                </div>
            `;

            container.appendChild(gameCard);
        }

        function removeFromWishlist(gameId, event) {
            event.stopPropagation();
            let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            wishlist = wishlist.filter(id => id !== gameId);
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            loadWishlist(); // Reload wishlist
        }

        function handleSearch(event) {
            event.preventDefault();
            const query = document.getElementById('searchInput').value;
            if (query.trim()) {
                window.location.href = `searched_for.html?q=${encodeURIComponent(query)}`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadWishlist);
    </script>
</body>
</html>
