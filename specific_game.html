<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Details - iGameDB</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="js/rawg-api.js"></script>
    <style>
        .game-details {
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 20px;
            margin-top: 20px;
        }

        .game-details h3 {
            color: #f5c518;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .game-details p {
            color: #cccccc;
            line-height: 1.6;
        }

        .platforms-list, .genres-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag {
            background-color: #2a2a2a;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            border: 1px solid #f5c518;
            color: #f5c518;
        }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="logo-placeholder" style="text-decoration: none;">
            iGameDB
        </a>

        <div class="search-bar-main">
            <form onsubmit="handleSearch(event)">
                <input type="text" placeholder="Search..." aria-label="Search games" id="searchInput">
            </form>
        </div>

        <nav class="nav-buttons">
            <a href="wishlist.html" class="wishlist">Wishlist</a>
            <a href="signin.html" class="sign-in">Sign In</a>
            <a href="about_us.html" class="about-link">About Us</a>
        </nav>
    </div>

    <div class="container">
        <section class="specific-game-section" id="gameSection">
            <div style="text-align: center; padding: 40px;">Loading game details...</div>
        </section>
    </div>

    <footer class="footer">
        <div class="logo-placeholder">
            iGameDB
        </div>

        <div class="footer-buttons">
            <button class="about" onclick="window.location.href='about_us.html'">About Us</button><br>
            <button class="follow">Follow Us</button>
        </div>
    </footer>

    <script>
        const API_KEY = '266fadd8dc914070b892d47f91163eeb'; // Replace with your RAWG API key

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function loadGameDetails() {
            const gameId = getQueryParam('id');
            if (!gameId) {
                document.getElementById('gameSection').innerHTML = '<p>No game ID provided.</p>';
                return;
            }

            const game = await fetchGameDetails(gameId);
            const screenshots = await fetchGameScreenshots(gameId);

            if (!game) {
                document.getElementById('gameSection').innerHTML = '<p>Game not found.</p>';
                return;
            }

            let platformsHtml = '';
            if (game.platforms && game.platforms.length > 0) {
                platformsHtml = game.platforms.map(p => `<span class="tag">${p.platform.name}</span>`).join('');
            }

            let genresHtml = '';
            if (game.genres && game.genres.length > 0) {
                genresHtml = game.genres.map(g => `<span class="tag">${g.name}</span>`).join('');
            }

            let screenshotsHtml = '';
            if (screenshots && screenshots.length > 0) {
                screenshotsHtml = screenshots.slice(0, 4).map(s => 
                    `<div class="game-card" style="background-image: url(${s.image}); background-size: cover; background-position: center;"></div>`
                ).join('');
            }

            const description = game.description ? game.description.replace(/<[^>]*>/g, '') : game.description_raw || 'No description available.';

            const html = `
                <div class="game-header">
                    <div class="game-logo-large" style="background-image: url(${game.background_image}); background-size: cover; background-position: center;">
                        ${!game.background_image ? game.name.charAt(0).toUpperCase() : ''}
                    </div>
                    <div class="game-info">
                        <h1>${game.name}</h1>
                        <p class="game-description">${description.substring(0, 300)}...</p>
                        <div style="margin: 20px 0;">
                            <p><strong>Rating:</strong> <span style="color: #f5c518;">‚≠ê ${game.rating}/5</span></p>
                            <p><strong>Released:</strong> ${game.released || 'N/A'}</p>
                            <p><strong>Developer:</strong> ${game.developers && game.developers[0] ? game.developers[0].name : 'N/A'}</p>
                        </div>
                        <button class="add-to-wishlist" onclick="toggleWishlist(${game.id})">Add to Wishlist</button>
                    </div>
                </div>
                
                <hr style="border: 0; border-top: 1px solid #444444; margin: 30px 0;">

                <div class="game-details">
                    <h3>Platforms</h3>
                    <div class="platforms-list">${platformsHtml || '<p>N/A</p>'}</div>

                    <h3>Genres</h3>
                    <div class="genres-list">${genresHtml || '<p>N/A</p>'}</div>
                </div>

                ${screenshotsHtml ? `
                    <div class="game-gallery">
                        <h2>Screenshots</h2>
                        <div class="game-grid">
                            ${screenshotsHtml}
                        </div>
                    </div>
                ` : ''}
            `;

            document.getElementById('gameSection').innerHTML = html;
        }

        function toggleWishlist(gameId) {
            const btn = event.target;
            if (btn.textContent === 'Add to Wishlist') {
                btn.textContent = 'Remove from Wishlist';
                btn.style.backgroundColor = '#ff6b6b';
                // Store in localStorage for persistence
                let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
                if (!wishlist.includes(gameId)) {
                    wishlist.push(gameId);
                    localStorage.setItem('wishlist', JSON.stringify(wishlist));
                }
            } else {
                btn.textContent = 'Add to Wishlist';
                btn.style.backgroundColor = '#f5c518';
                // Remove from localStorage
                let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
                wishlist = wishlist.filter(id => id !== gameId);
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
            }
        }

        function handleSearch(event) {
            event.preventDefault();
            const query = document.getElementById('searchInput').value;
            if (query.trim()) {
                window.location.href = `searched_for.html?q=${encodeURIComponent(query)}`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadGameDetails);
    </script>
</body>
</html>
